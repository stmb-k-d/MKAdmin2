{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}–î–µ—Ç–∞–ª–∏ –ø—Ä–æ–∫—Å–∏{% endblock %}

{% block page_title %}–î–µ—Ç–∞–ª–∏ –ø—Ä–æ–∫—Å–∏{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–∫—Å–∏</h5>
        <div>
            {% if proxy %}
            <button class="btn btn-outline-danger me-2" id="deleteProxyBtn" data-proxy-id="{{ proxy.proxy_id }}">
                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–∫—Å–∏
            </button>
            {% endif %}
            <a href="{% url 'dashboard:proxy' %}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
            </a>
        </div>
    </div>
    <div class="card-body">
        {% if proxy %}
            <div class="row">
                <div class="col-md-6">
                    <table class="table table-bordered">
                        <tr>
                            <th>ID</th>
                            <td>{{ proxy.proxy_id }}</td>
                        </tr>
                        <tr>
                            <th>IP</th>
                            <td>{{ proxy.ip }}</td>
                        </tr>
                        <tr>
                            <th>–¢–∏–ø</th>
                            <td>{{ proxy.type }}</td>
                        </tr>
                        <tr>
                            <th>–õ–æ–≥–∏–Ω</th>
                            <td>{{ proxy.login|default:"-" }}</td>
                        </tr>
                        <tr>
                            <th>–ü–∞—Ä–æ–ª—å</th>
                            <td>{{ proxy.psw|default:"-" }}</td>
                        </tr>
                        <tr>
                            <th>–ü–æ—Ä—Ç SOCKS5</th>
                            <td>{{ proxy.port_socks5 }}</td>
                        </tr>
                        <tr>
                            <th>–ü–æ—Ä—Ç HTTPS</th>
                            <td>{{ proxy.port_https }}</td>
                        </tr>
                        <tr>
                            <th>–ì–µ–æ</th>
                            <td>
                                {% with country_code=proxy.geo|lower %}
                                    {% if country_code == 'us' %}üá∫üá∏
                                    {% elif country_code == 'gb' %}üá¨üáß
                                    {% elif country_code == 'de' %}üá©üá™
                                    {% elif country_code == 'fr' %}üá´üá∑
                                    {% elif country_code == 'it' %}üáÆüáπ
                                    {% elif country_code == 'es' %}üá™üá∏
                                    {% elif country_code == 'nl' %}üá≥üá±
                                    {% elif country_code == 'pl' %}üáµüá±
                                    {% elif country_code == 'ru' %}üá∑üá∫
                                    {% elif country_code == 'ua' %}üá∫üá¶
                                    {% elif country_code == 'kz' %}üá∞üáø
                                    {% elif country_code == 'br' %}üáßüá∑
                                    {% elif country_code == 'ca' %}üá®üá¶
                                    {% elif country_code == 'au' %}üá¶üá∫
                                    {% elif country_code == 'jp' %}üáØüáµ
                                    {% elif country_code == 'kr' %}üá∞üá∑
                                    {% elif country_code == 'cn' %}üá®üá≥
                                    {% elif country_code == 'in' %}üáÆüá≥
                                    {% elif country_code == 'sg' %}üá∏üá¨
                                    {% elif country_code == 'ae' %}üá¶üá™
                                    {% endif %}
                                    {{ proxy.geo|upper }}
                                {% endwith %}
                            </td>
                        </tr>
                        <tr>
                            <th>–°—Å—ã–ª–∫–∞ —Å–º–µ–Ω—ã IP</th>
                            <td>{{ proxy.link_change_ip|default:"-" }}</td>
                        </tr>
                    </table>
                </div>
                <div class="col-md-6">
                    <table class="table table-bordered">
                        <tr>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <td>
                                {% if proxy.status == 'work' %}
                                    <span class="badge bg-success">–ê–∫—Ç–∏–≤–Ω—ã–π</span>
                                {% elif proxy.status == 'new' %}
                                    <span class="badge bg-warning">–ù–æ–≤—ã–π</span>
                                {% elif proxy.status == 'inactive' %}
                                    <span class="badge bg-danger">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π</span>
                                {% else %}
                                    <span class="badge bg-secondary">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                            <td>{{ proxy.proxy_cost|floatformat:2 }} {{ proxy.proxy_cur }}</td>
                        </tr>
                        <tr>
                            <th>–ê–∫–∫–∞—É–Ω—Ç</th>
                            <td>{{ proxy.accs|default:"-" }}</td>
                        </tr>
                        <tr>
                            <th>FBT ID</th>
                            <td>{{ proxy.fbt_id|default:"-" }}</td>
                        </tr>
                        <tr>
                            <th>–î–ª—è Octo</th>
                            <td>{{ proxy.for_octo|yesno:"–î–∞,–ù–µ—Ç" }}</td>
                        </tr>
                        <tr>
                            <th>Octo UUID</th>
                            <td>{{ proxy.octo_uuid|default:"-" }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        {% else %}
            <div class="alert alert-warning">
                –ü—Ä–æ–∫—Å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
            </div>
        {% endif %}
    </div>
</div>

{% if proxy %}
<!-- Modal –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
<div class="modal fade" id="deleteProxyModal" tabindex="-1" aria-labelledby="deleteProxyModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteProxyModalLabel">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø—Ä–æ–∫—Å–∏?</p>
                <p><strong>IP:</strong> {{ proxy.ip }}</p>
                <p class="text-muted">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">–î–∞, —É–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const deleteBtn = document.getElementById('deleteProxyBtn');
    const deleteModalElement = document.getElementById('deleteProxyModal');
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    
    if (deleteBtn && deleteModalElement) {
        const deleteModal = new bootstrap.Modal(deleteModalElement);
        
        deleteBtn.addEventListener('click', function() {
            deleteModal.show();
        });
        
        if (confirmDeleteBtn) {
            confirmDeleteBtn.addEventListener('click', function() {
                const proxyId = deleteBtn.getAttribute('data-proxy-id');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                confirmDeleteBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> –£–¥–∞–ª–µ–Ω–∏–µ...';
                confirmDeleteBtn.disabled = true;
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
                fetch(`/proxy/delete/${proxyId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // –£—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–∫—Å–∏
                        window.location.href = "{% url 'dashboard:proxy' %}";
                    } else {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + data.error);
                        confirmDeleteBtn.innerHTML = '–î–∞, —É–¥–∞–ª–∏—Ç—å';
                        confirmDeleteBtn.disabled = false;
                        deleteModal.hide();
                    }
                })
                .catch(error => {
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + error.message);
                    confirmDeleteBtn.innerHTML = '–î–∞, —É–¥–∞–ª–∏—Ç—å';
                    confirmDeleteBtn.disabled = false;
                    deleteModal.hide();
                });
            });
        }
    }
});
</script>
{% endblock %} 